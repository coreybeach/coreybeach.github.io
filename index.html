<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cruise Master Plan</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#101a2e;
      --card2:#0f172a;
      --text:#e5e7eb;
      --muted:#a6b0c3;
      --border:rgba(255,255,255,.08);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px;

      --blue:#60a5fa;
      --green:#34d399;
      --yellow:#fbbf24;
      --red:#f87171;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(900px 600px at 20% -10%, rgba(96,165,250,.22), transparent 55%),
        radial-gradient(900px 600px at 80% 0%, rgba(52,211,153,.18), transparent 55%),
        var(--bg);
      color:var(--text);
      line-height:1.35;
    }

    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(11,18,32,.72);
      border-bottom: 1px solid var(--border);
    }
    .topbar-inner{
      max-width:1100px; margin:0 auto; padding:12px 14px;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
    }
    .brand{display:flex; flex-direction:column; gap:2px;}
    .brand .title{font-weight:800; letter-spacing:.2px}
    .brand .sub{color:var(--muted); font-size:12px}
    .nav{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;}
    .pilllink{
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--border);
      background: rgba(16,26,46,.65);
      font-size:13px;
      transition:.15s transform ease, .15s background ease;
      white-space:nowrap;
      color:inherit; text-decoration:none;
    }
    .pilllink:hover{background: rgba(16,26,46,.9)}
    .pilllink:active{transform:scale(.98)}
    .pilllink.accent{border-color: rgba(96,165,250,.35)}

    .wrap{max-width:1100px; margin:0 auto; padding:16px 14px 70px;}
    section{margin-top:18px}
    .section-head{
      display:flex; align-items:flex-end; justify-content:space-between; gap:10px; margin:8px 0 10px;
    }
    h2{margin:0; font-size:18px; letter-spacing:.2px}
    .note{color:var(--muted); font-size:12px}

    .grid{display:grid; grid-template-columns: 1fr; gap:12px;}
    @media (min-width: 860px){ .grid.two{grid-template-columns: 1fr 1fr} }

    .card{
      background: linear-gradient(180deg, rgba(16,26,46,.92), rgba(15,23,42,.92));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px 14px 12px;
    }
    .card h3{margin:0 0 8px; font-size:15px;}
    .kv{display:flex; gap:10px; flex-wrap:wrap; color:var(--muted); font-size:12px;}
    .chip{
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
    }

    .list{margin:10px 0 0; padding:0; list-style:none; display:flex; flex-direction:column; gap:8px;}
    .li{padding:10px 10px; border-radius: 12px; background: rgba(255,255,255,.03); border:1px solid var(--border);}
    .li .when{font-family:var(--mono); color:#cdd6e7; font-size:12px}
    .li .what{margin-top:2px}
    .muted{color:var(--muted)}
    .small{font-size:12px; color: var(--muted)}

    /* Day selector */
    .daybar{
      display:flex; gap:8px; overflow:auto; padding-bottom:6px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .daybar::-webkit-scrollbar{display:none}
    .daybtn{
      flex: 0 0 auto;
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(16,26,46,.75);
      color: #e5e7eb;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      user-select: none;
      transition:
        background .15s ease,
        transform .15s ease,
        color .15s ease,
        box-shadow .15s ease;
    }
    .daybtn:hover{background: rgba(16,26,46,.95); color:#fff;}
    .daybtn:active{transform: scale(.97);}
    .daybtn.active{
      color: #ffffff;
      background: linear-gradient(180deg, rgba(96,165,250,.35), rgba(59,130,246,.35));
      border-color: rgba(96,165,250,.6);
      box-shadow: 0 0 0 2px rgba(96,165,250,.25) inset;
    }

    .daypanel{display:none}
    .daypanel.active{display:block}

    /* Tag pills (matches your screenshot vibe) */
    .tagbar{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
    .tagpill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--text);
      white-space:nowrap;
    }
    .tagpill.locked{ background: rgba(52,211,153,.16); border-color: rgba(52,211,153,.35); }
    .tagpill.flex{   background: rgba(251,191,36,.16); border-color: rgba(251,191,36,.35); color:#fff; }
    .tagpill.priority{ background: rgba(96,165,250,.16); border-color: rgba(96,165,250,.35); }
    .tagpill.risk{   background: rgba(248,113,113,.16); border-color: rgba(248,113,113,.35); }

    /* Grid table */
    .table-wrap{
      overflow:auto;
      border-radius: var(--radius);
      border:1px solid var(--border);
      background: rgba(16,26,46,.55);
    }
    table{ width:100%; border-collapse:collapse; min-width:980px; }
    th, td{
      border-bottom:1px solid var(--border);
      border-right:1px solid var(--border);
      padding:10px 10px;
      vertical-align: top;
      font-size:13px;
    }
    th{
      position:sticky; top:0;
      background: rgba(11,18,32,.95);
      z-index:1;
      text-align:left;
      font-size:12px;
      letter-spacing:.2px;
      color: var(--muted);
    }
    td:first-child, th:first-child{
      position:sticky; left:0;
      background: rgba(11,18,32,.95);
      z-index:2;
      font-family: var(--mono);
      font-size:12px;
      color:#cdd6e7;
      width:130px;
    }
    tr:last-child td{border-bottom:none}
    td:last-child, th:last-child{border-right:none}
    td .eventline{margin:0 0 10px}
    td .eventline:last-child{margin-bottom:0}
    td .eventtitle{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
    td .eventtitle strong{font-weight:650}
    td .eventmeta{margin-top:3px}
    td .eventtags{margin-top:8px; display:flex; gap:8px; flex-wrap:wrap}
    .cell-muted{color: var(--muted)}
    .footer{margin-top:18px; color: var(--muted); font-size:12px; text-align:center;}
    .codehint{
      font-family: var(--mono);
      font-size:12px;
      color: var(--muted);
      white-space:pre-wrap;
      background: rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius: 12px;
      padding:10px;
      margin-top:10px;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="title">üõ≥Ô∏è Cruise Master Plan</div>
        <div class="sub" id="subtitle">All times = ship time ‚Ä¢ Offline-friendly</div>
      </div>
      <nav class="nav">
        <a class="pilllink accent" href="#today">Today</a>
        <a class="pilllink" href="#glance">At-a-glance</a>
        <a class="pilllink" href="#grid">Visual grid</a>
        <a class="pilllink" href="#days">Days</a>
        <a class="pilllink" href="#edit">Edit tips</a>
      </nav>
    </div>
  </div>

  <div class="wrap">
    <section id="today">
      <div class="section-head">
        <h2>üìå Today (tap a day below)</h2>
        <div class="note">Tip: Add to Home Screen for 1-tap access.</div>
      </div>

      <div class="card">
        <div class="daybar" id="daybar"></div>
        <div class="timeline" id="todayPanel"></div>
      </div>
    </section>

    <section id="glance">
      <div class="section-head">
        <h2>üëÄ At-a-glance</h2>
        <div class="note">Fast decisions without scrolling a full timeline.</div>
      </div>

      <div class="grid two" id="glanceTop"></div>
      <div class="grid two" style="margin-top:12px" id="glanceBottom"></div>
    </section>

    <section id="grid">
      <div class="section-head">
        <h2>üóìÔ∏è Visual grid</h2>
        <div class="note">Scroll horizontally on phone ‚Ä¢ sticky headers + time column.</div>
      </div>
      <div class="table-wrap" id="gridTable"></div>
    </section>

    <section id="days">
      <div class="section-head">
        <h2>üìÖ Full day-by-day</h2>
        <div class="note">Same data as Today + Grid, but all visible at once.</div>
      </div>
      <div class="grid two" id="allDays"></div>
    </section>

    <section id="edit">
      <div class="section-head">
        <h2>üõ†Ô∏è Easy edits</h2>
        <div class="note">Change only the JSON block below (no HTML/CSS changes needed).</div>
      </div>
      <div class="card">
        <h3>Common edits</h3>
        <div class="codehint">
1) Update times by editing: days.dX.events[].start/end (24h "HH:MM", use "24:00" for midnight)
2) Mark status with tags: ["locked"] / ["flex"] / ["priority"] / ["risk"]
3) Dining placeholders: use end:null and tags:["flex"]
4) Grid colors come from tags automatically (green=Booked, yellow=Flexible, blue=Priority, red=Risk)
        </div>
      </div>
    </section>

    <div class="footer">
      iPhone Safari ‚Üí Share ‚Üí ‚ÄúAdd to Home Screen‚Äù. Android Chrome ‚Üí Menu ‚Üí ‚ÄúAdd to Home screen‚Äù.
    </div>
  </div>

  <script>
    /*****************************************************************
     * EDIT HERE: CRUISE_DATA (easy-to-edit JSON-like object)
     * - I removed the yellow-square emoji style; status now comes from tags.
     *****************************************************************/
    const CRUISE_DATA = {
      meta: {
        subtitle: "All times = ship time ‚Ä¢ Offline-friendly",
        days: [
          { id:"d1", label:"Day 1", title:"Miami / Sail Away" },
          { id:"d2", label:"Day 2", title:"Sea Day" },
          { id:"d3", label:"Day 3", title:"Puerto Costa Maya (8:00‚Äì5:00)" },
          { id:"d4", label:"Day 4", title:"Roat√°n (7:00‚Äì4:00)" },
          { id:"d5", label:"Day 5", title:"Cozumel (8:00‚Äì6:00)" },
          { id:"d6", label:"Day 6", title:"Sea Day" },
          { id:"d7", label:"Day 7", title:"CocoCay (7:00‚Äì5:00)" }
        ]
      },

      glance: {
        dining: [
          { day:"Day 1", text:"üçΩÔ∏è My Time Dining (6:30‚Äì?)", tags:["flex"] },
          { day:"Day 2", text:"üçΩÔ∏è My Time Dining (6:45‚Äì?)", tags:["locked"] },
          { day:"Day 3", text:"üçΩÔ∏è My Time Dining (7:00‚Äì?)", tags:["flex"] },
          { day:"Day 4", text:"üçΩÔ∏è My Time Dining (6:45‚Äì?)", tags:["locked"] },
          { day:"Day 5", text:"üçΩÔ∏è My Time Dining (8:30‚Äì?)", tags:["locked"] },
          { day:"Day 6", text:"üçΩÔ∏è My Time Dining (6:30‚Äì?)", tags:["flex"] },
          { day:"Day 7", text:"üçΩÔ∏è Dinner after Starburst (after ~8:15)", tags:["flex"] }
        ],
        ports: [
          { day:"Day 3", text:"Puerto Costa Maya (8:00‚Äì5:00) ‚Äî Explore" },
          { day:"Day 4", text:"Roat√°n (7:00‚Äì4:00) ‚Äî Zipline 9:00 (meet ~8:30)" },
          { day:"Day 5", text:"Cozumel (8:00‚Äì6:00) ‚Äî ATV + Jade Caverns 10:00 (ready ~9:30)" },
          { day:"Day 7", text:"CocoCay (7:00‚Äì5:00) ‚Äî Chill day" }
        ],
        entertainment: [
          { day:"Day 1", text:"Headliner (9:30‚Äì10:20) ‚Ä¢ Sing-Along (11:50‚Äì12:00) ‚Ä¢ Balloon Drop/DJ (12:00‚ÄìLate)" },
          { day:"Day 2", text:"Adult Comedy (11:30‚Äì12:25)" },
          { day:"Day 3", text:"Wizard of Oz (4:30‚Äì6:10) ‚Ä¢ Adult Comedy (11:30‚Äì12:25)" },
          { day:"Day 4", text:"Love & Marriage (9:00‚Äì10:00)", tags:["priority"] },
          { day:"Day 5", text:"Price Is Right (7:00‚Äì8:00) ‚Ä¢ Crazy Quest (11:00‚Äì11:45)", tags:["priority"] },
          { day:"Day 6", text:"Aqua Action (10:30‚Äì11:30)" },
          { day:"Day 7", text:"Starburst (7:15‚Äì8:05) ‚Ä¢ Adult Comedy (10:30‚Äì11:25)" }
        ],
        risk: [
          { label:"Early mornings", text:"Day 4 (Zipline) ‚Ä¢ Day 5 (ATV)" },
          { label:"Late-night risk", text:"Day 1 (past midnight) ‚Ä¢ Day 3 (comedy ends 12:25 ‚Üí early excursion)", tags:["risk"] },
          { label:"High-energy days", text:"Day 4 ‚Ä¢ Day 5" },
          { label:"Recovery days", text:"Day 2 ‚Ä¢ Day 6 ‚Ä¢ Day 7 (choose chill)" },
          { label:"Best nights to book more", text:"Day 2 ‚Ä¢ Day 6 (Sea Days)" }
        ],
        logistics: [
          { label:"Arrive early rule", text:"Aim to be seated ~10‚Äì15 min before shows; meet buffers ~30 min for excursions." },
          { label:"Venue quick map", text:"Royal Theater (Deck 4 Fwd) ‚Ä¢ The Attic (Deck 6 Fwd) ‚Ä¢ Absolute Zero (Deck 6 Aft) ‚Ä¢ AquaTheater (Deck 15 Fwd) ‚Ä¢ Promenade (Deck 5 Mid) ‚Ä¢ Music Hall (Deck 3 Fwd)" },
          { label:"Safety briefing", text:"Complete mandatory guest safety briefing on Day 1 (as shown in app window).", tags:["priority"] },
          { label:"Ship time", text:"All times shown are Ship Time." }
        ]
      },

      days: {
        d1: {
          chips: ["üìç Miami ‚Üí Sail Away", "üçΩÔ∏è Dining flexible", "üßØ Safety briefing required"],
          events: [
            { start:"16:30", end:"17:00", title:"üéâ Sail Away Party", venue:"Pool Deck (D16)" },
            { start:"18:30", end:null, title:"üçΩÔ∏è My Time Dining", tags:["flex"] },
            { start:"21:30", end:"22:20", title:"üé≠ Headliner", venue:"Royal Theater (D4 Fwd)" },
            { start:"23:50", end:"24:00", title:"üé∂ Big Welcome Sing-Along", venue:"Royal Promenade (D5 Mid)" },
            { start:"24:00", end:null, title:"üéâ Balloon Drop + After Hours DJ", venue:"Promenade (D5 Mid) / Music Hall (D3 Fwd)" }
          ]
        },

        d2: {
          chips: ["üåä Sea Day", "üçΩÔ∏è Booked dining"],
          events: [
            { start:"18:45", end:null, title:"üçΩÔ∏è My Time Dining", tags:["locked"] },
            { start:"23:30", end:"24:25", title:"üé§ Adult Comedy (18+)", venue:"The Attic (D6 Fwd)" }
          ]
        },

        d3: {
          chips: ["üèùÔ∏è Puerto Costa Maya (8:00‚Äì5:00)", "üçΩÔ∏è Dining shifted", "‚ö†Ô∏è Late night risk"],
          events: [
            { start:"08:00", end:"17:00", title:"üèùÔ∏è Port day (explore)" },
            { start:"16:30", end:"18:10", title:"üé≠ The Wizard of Oz", venue:"Royal Theater (D4 Fwd)" },
            { start:"19:00", end:null, title:"üçΩÔ∏è My Time Dining", tags:["flex"] },
            { start:"23:30", end:"24:25", title:"üé§ Adult Comedy (18+)", venue:"The Attic (D6 Fwd)", tags:["risk"] }
          ]
        },

        d4: {
          chips: ["üèùÔ∏è Roat√°n (7:00‚Äì4:00)", "üßó Zipline 9:00 (meet ~8:30)", "üçΩÔ∏è Booked dining"],
          events: [
            { start:"08:30", end:null, title:"‚è±Ô∏è Meet buffer (excursion)", tags:["priority"] },
            { start:"09:00", end:null, title:"üßó Zip & Dip (Excursion)", venue:"Port of Roat√°n", tags:["priority"] },
            { start:"18:45", end:null, title:"üçΩÔ∏è My Time Dining", tags:["locked"] },
            { start:"21:00", end:"22:00", title:"üéÆ Game Show: Love & Marriage", venue:"Royal Theater (D4 Fwd)", tags:["priority"] }
          ]
        },

        d5: {
          chips: ["üèùÔ∏è Cozumel (8:00‚Äì6:00)", "üõû ATV 10:00 (ready ~9:30)", "üçΩÔ∏è Booked dining 8:30"],
          events: [
            { start:"09:30", end:null, title:"‚è±Ô∏è Ready buffer (excursion)", tags:["priority"] },
            { start:"10:00", end:null, title:"üõû ATV Ride to Jade Caverns (Excursion)", venue:"Cozumel", tags:["priority"] },
            { start:"19:00", end:"20:00", title:"üéÆ Price Is Right ‚Äì Everyone‚Äôs a Contestant", venue:"Royal Theater (D4 Fwd)", tags:["priority"] },
            { start:"20:30", end:null, title:"üçΩÔ∏è My Time Dining", tags:["locked"] },
            { start:"23:00", end:"23:45", title:"üéÆ The Crazy Quest (18+)", venue:"Absolute Zero (D6 Aft)", tags:["priority"] }
          ]
        },

        d6: {
          chips: ["üåä Sea Day", "üçΩÔ∏è Dining flexible", "üí¶ Aqua Action booked"],
          events: [
            { start:"18:30", end:null, title:"üçΩÔ∏è My Time Dining", tags:["flex"] },
            { start:"22:30", end:"23:30", title:"üí¶ AQUA ACTION!", venue:"AquaTheater (D15 Fwd)", tags:["locked"] }
          ]
        },

        d7: {
          chips: ["üèùÔ∏è CocoCay (7:00‚Äì5:00)", "‚ú® Starburst 7:15", "üçΩÔ∏è Dinner after Starburst"],
          events: [
            { start:"07:00", end:"17:00", title:"üèùÔ∏è Perfect Day at CocoCay" },
            { start:"19:15", end:"20:05", title:"‚ú® Starburst: Elemental Beauty", venue:"Absolute Zero (D6 Aft)", tags:["locked"] },
            { start:"20:15", end:null, title:"üçΩÔ∏è Dinner (placeholder after Starburst)", tags:["flex"] },
            { start:"22:30", end:"23:25", title:"üé§ Adult Comedy (18+)", venue:"Royal Theater (D4 Fwd)" }
          ]
        }
      },

      gridSlots: [
        { label:"4:30‚Äì6:10", start:"16:30", end:"18:10" },
        { label:"6:30‚Äì9:30", start:"18:30", end:"21:30" },
        { label:"7:00‚Äì8:10", start:"19:00", end:"20:10" },
        { label:"8:15‚Äì?",   start:"20:15", end:null },
        { label:"9:00‚Äì10:00", start:"21:00", end:"22:00" },
        { label:"9:30‚Äì10:20", start:"21:30", end:"22:20" },
        { label:"10:30‚Äì11:30", start:"22:30", end:"23:30" },
        { label:"11:00‚Äì11:45", start:"23:00", end:"23:45" },
        { label:"11:30‚Äì12:25", start:"23:30", end:"24:25" },
        { label:"11:50‚Äì12:00", start:"23:50", end:"24:00" },
        { label:"12:00‚ÄìLate",  start:"24:00", end:null }
      ],

      debark: {
        when:"Jan 31 ‚Ä¢ 6:00 AM",
        text:"üß≥ Arrive Miami ‚Äî plan bags/exit timing accordingly"
      }
    };

    /*********************
     * Helpers
     *********************/
    const pad2 = n => String(n).padStart(2,"0");

    function toMin(hhmm){
      if(hhmm == null) return null;
      const [h,m] = hhmm.split(":").map(Number);
      return h*60 + m;
    }
    function fmtTime(hhmm){
      if(hhmm == null) return "‚Äî";
      const [h,m] = hhmm.split(":").map(Number);
      if(h === 24 && m === 0) return "12:00a";
      const ampm = h >= 12 ? "p" : "a";
      const hh = ((h + 11) % 12) + 1;
      return `${hh}:${pad2(m)}${ampm}`;
    }
    function fmtRange(start,end){
      if(end == null) return `${fmtTime(start)}‚Äì?`;
      return `${fmtTime(start)}‚Äì${fmtTime(end)}`;
    }

    function tagLabel(tag){
      if(tag==="locked") return "Booked";
      if(tag==="flex") return "Flexible";
      if(tag==="priority") return "Priority";
      if(tag==="risk") return "Risk";
      return tag;
    }

    function renderTagPills(tags){
      if(!tags || !tags.length) return "";
      return `<div class="eventtags">${tags.map(t => `<span class="tagpill ${t}">${tagLabel(t)}</span>`).join("")}</div>`;
    }

    function renderEventLine(ev){
      const time = fmtRange(ev.start, ev.end);
      const venue = ev.venue ? `<div class="eventmeta small">${ev.venue}</div>` : "";
      const tags = renderTagPills(ev.tags);
      return `
        <div class="eventline">
          <div class="eventtitle">
            <strong>${ev.title}</strong>
            <span class="small" style="font-family:var(--mono); color:#cdd6e7">${time}</span>
          </div>
          ${venue}
          ${tags}
        </div>
      `;
    }

    function isDiningEvent(ev){
  const t = (ev.title || "").toLowerCase();
  const tags = new Set(ev.tags || []);
  return t.includes("dining") || tags.has("locked") || tags.has("flex");
}

function eventEndForGrid(ev){
  // If the event has an explicit end, use it.
  if(ev.end) return toMin(ev.end);

  const start = toMin(ev.start);
  if(start == null) return null;

  // Only dining (or true "open-ended") should span late blocks.
  if(isDiningEvent(ev)) return 24*60 + 120;

  // Otherwise, treat end:null as a short block for grid placement
  // (prevents morning excursions from showing in dinner rows).
  return start + 60; // 60 min default (adjust if you want 30)
}

function overlaps(slot, ev){
  const s1 = toMin(slot.start);
  const e1 = toMin(slot.end) ?? (24*60 + 120);

  const s2 = toMin(ev.start);
  const e2 = eventEndForGrid(ev) ?? (s2 + 60);

  return (s2 < e1) && (e2 > s1);
}


    /*********************
     * Render: Today
     *********************/
    function renderToday(){
      const daybar = document.getElementById("daybar");
      const todayPanel = document.getElementById("todayPanel");
      daybar.innerHTML = "";
      todayPanel.innerHTML = "";

      CRUISE_DATA.meta.days.forEach((d, idx) => {
        const btn = document.createElement("button");
        btn.className = "daybtn" + (idx===0 ? " active" : "");
        btn.dataset.day = d.id;
        btn.textContent = d.label;
        daybar.appendChild(btn);

        const dayObj = CRUISE_DATA.days[d.id];
        const chips = (dayObj.chips||[]).map(c => `<span class="chip">${c}</span>`).join("");
        const events = (dayObj.events||[]).map(ev => `
          <li class="li">
            <div class="when">${fmtRange(ev.start, ev.end)}</div>
            <div class="what">
              ${ev.title}
              ${ev.venue ? `<div class="small">${ev.venue}</div>` : ""}
              ${renderTagPills(ev.tags)}
            </div>
          </li>
        `).join("");

        const panel = document.createElement("div");
        panel.className = "daypanel" + (idx===0 ? " active" : "");
        panel.id = d.id;
        panel.innerHTML = `
          <div class="kv">${chips}</div>
          <ul class="list">${events || `<li class="li"><div class="what muted">No events listed.</div></li>`}</ul>
        `;
        todayPanel.appendChild(panel);
      });

      // hook day switching
      const buttons = Array.from(document.querySelectorAll(".daybtn"));
      const panels = Array.from(document.querySelectorAll(".daypanel"));
      function setDay(id){
        buttons.forEach(b => b.classList.toggle("active", b.dataset.day === id));
        panels.forEach(p => p.classList.toggle("active", p.id === id));
        history.replaceState(null, "", "#today");
      }
      buttons.forEach(b => b.addEventListener("click", () => setDay(b.dataset.day)));
    }

    /*********************
     * Render: At-a-glance cards
     *********************/
    function renderGlance(){
      const top = document.getElementById("glanceTop");
      const bottom = document.getElementById("glanceBottom");

      const makeList = (items, mode="dayText") => {
        if(mode==="dayText"){
          return `<ul class="list">${items.map(it => `
            <li class="li">
              <div class="when">${it.day}</div>
              <div class="what">
                ${it.text}
                ${renderTagPills(it.tags)}
              </div>
            </li>
          `).join("")}</ul>`;
        }
        // label/text
        return `<ul class="list">${items.map(it => `
          <li class="li">
            <div class="when">${it.label}</div>
            <div class="what">
              ${it.text}
              ${renderTagPills(it.tags)}
            </div>
          </li>
        `).join("")}</ul>`;
      };

      top.innerHTML = `
        <div class="card">
          <h3>üé≠ Entertainment</h3>
          ${makeList(CRUISE_DATA.glance.entertainment, "dayText")}
        </div>
        <div class="card">
          <h3>üèùÔ∏è Ports & Excursions</h3>
          ${makeList(CRUISE_DATA.glance.ports, "dayText")}
        </div>
      `;

      bottom.innerHTML = `
        <div class="card">
          <h3>üçΩÔ∏è Dining</h3>
          ${makeList(CRUISE_DATA.glance.dining, "dayText")}
        </div>
        <div class="card">
          <h3>‚ö†Ô∏è Risk & Energy</h3>
          ${makeList(CRUISE_DATA.glance.risk, "labelText")}
        </div>
        <div class="card" style="grid-column: 1 / -1;">
          <h3>üß≠ Logistics</h3>
          ${makeList(CRUISE_DATA.glance.logistics, "labelText")}
        </div>
      `;
    }

    /*********************
     * Render: Visual grid
     * - Uses the same tags as everywhere else (Booked/Flexible/etc. pills)
     * - No yellow-square emoji. Status is derived from tags.
     *********************/
    function renderGrid(){
      const wrap = document.getElementById("gridTable");
      const days = CRUISE_DATA.meta.days;

      let thead = `
        <thead>
          <tr>
            <th>Time Block</th>
            ${days.map(d => `<th>${d.label}<div class="small">${d.title}</div></th>`).join("")}
          </tr>
        </thead>
      `;

      let rows = CRUISE_DATA.gridSlots.map(slot => {
        const tds = days.map(d => {
          const events = (CRUISE_DATA.days[d.id]?.events || []).filter(ev => overlaps(slot, ev));
          if(!events.length) return `<td class="cell-muted">‚Äî</td>`;
          return `<td>${events.map(renderEventLine).join("")}</td>`;
        }).join("");
        return `<tr><td>${slot.label}</td>${tds}</tr>`;
      }).join("");

      wrap.innerHTML = `<table aria-label="Visual schedule grid">${thead}<tbody>${rows}</tbody></table>`;
    }

    /*********************
     * Render: Full day-by-day
     *********************/
    function renderAllDays(){
      const el = document.getElementById("allDays");
      const dayCards = CRUISE_DATA.meta.days.map(d => {
        const dayObj = CRUISE_DATA.days[d.id];
        const chips = (dayObj.chips||[]).map(c => `<span class="chip">${c}</span>`).join("");
        const events = (dayObj.events||[]).map(ev => `
          <li class="li">
            <div class="when">${fmtRange(ev.start, ev.end)}</div>
            <div class="what">
              ${ev.title}
              ${ev.venue ? `<div class="small">${ev.venue}</div>` : ""}
              ${renderTagPills(ev.tags)}
            </div>
          </li>
        `).join("");

        return `
          <div class="card">
            <h3>${d.label} ‚Äì ${d.title}</h3>
            <div class="kv">${chips}</div>
            <ul class="list">${events || `<li class="li"><div class="what muted">No events listed.</div></li>`}</ul>
          </div>
        `;
      }).join("");

      const debark = `
        <div class="card">
          <h3>üß≥ Debarkation</h3>
          <ul class="list">
            <li class="li">
              <div class="when">${CRUISE_DATA.debark.when}</div>
              <div class="what">${CRUISE_DATA.debark.text}</div>
            </li>
          </ul>
        </div>
      `;

      el.innerHTML = dayCards + debark;
    }

    /*********************
     * Boot
     *********************/
    function boot(){
      document.getElementById("subtitle").textContent = CRUISE_DATA.meta.subtitle || "";
      renderToday();
      renderGlance();
      renderGrid();
      renderAllDays();
    }
    boot();
  </script>
</body>
</html>
